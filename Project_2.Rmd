---
title: "Project_2"
=======:
author: "Amelia Kelly, Greg Ricalde, & Matt Wilchek"
date: "May 1, 2017"
output:
  ioslides_presentation:
    css: bulma.css
    smaller: yes
    transition: slower
    widescreen: yes
runtime: shiny
subtitle: An Exploratory Data Analysis
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
# Install necessary packages and include packages.
library(ggplot2) # for graphing
library(lattice) # for graphing
library(car) # for graphing
library(memisc) # for function case
library(HistData) # library containing data
library(grid) # for graphing
library(rsconnect) # for publishing to Shiny apps
library(RCurl) # for importing data from url
library(visreg) # for linear model
library(mice) # to impute values
library(VIM) # to visualize missingness patterns


# Import Global Temp data
GlobalTemp_csv <- getURL("https://raw.githubusercontent.com/mwilchek/GWU_Project.AnalyzingClimateChange/master/GlobalTemperatures.csv")
GlobalTemp <- read.csv(text = GlobalTemp_csv)
# Delete unwanted columns
GlobalTemp$LandAverageTemperatureUncertainty <- GlobalTemp$LandMaxTemperature <-
GlobalTemp$LandMaxTemperatureUncertainty <- GlobalTemp$LandMinTemperature <-
GlobalTemp$LandMinTemperatureUncertainty <- GlobalTemp$LandAndOceanAverageTemperature <-
GlobalTemp$LandAndOceanAverageTemperatureUncertainty <- GlobalTemp$dt <- GlobalTemp$Day <- GlobalTemp$Month <- NULL
head(GlobalTemp)

# Import City Temp data
CityTemp_csv <- getURL("https://raw.githubusercontent.com/mwilchek/GWU_Project.AnalyzingClimateChange/master/US_City.csv")
CityTemp <- read.csv(text = CityTemp_csv)
# Delete unwanted columns
CityTemp$AverageTemperatureUncertainty <- CityTemp$Country <- NULL
head(CityTemp)
tail(CityTemp)


```

## Goal (About)

## Research/Background

## Data Gathering, Impute/Prep Methods
```{r echo=TRUE}



```

  
## Exploratory Data Analysis

```{r}
# Look at Summary and Structure of both Global and City files.
summary(GlobalTemp)
summary(CityTemp)
str(GlobalTemp)
str(CityTemp)

# Look for patterns/causes of missing data for both Global and City files.
md.pattern(GlobalTemp)
md.pattern(CityTemp)
global_aggr = aggr(GlobalTemp, numbers=TRUE, sortVars=TRUE, labels=names(GlobalTemp), 
                   cex.axis=.7, gap=3, ylab=c("Proportion of missingness","Missingness Pattern"))
city_aggr = aggr(CityTemp, numbers=TRUE, sortVars=TRUE, labels=names(CityTemp), 
                   cex.axis=.7, gap=3, ylab=c("Proportion of missingness","Missingness Pattern"))

# We are not running models on cities, so we will not impute missing values; eliminate missing values.
CityTemp <- CityTemp[!(is.na(CityTemp$AverageTemperature)) | !(is.na(CityTemp$AverageTemperature)),]
```


## Maps
```{r}
US_MapTest <- US_City_Simple[which(US_City_Simple$Year==2013),]
AvgUS_MapTest <- aggregate(US_MapTest$AverageTemperature, 
                     by=list(US_MapTest$Year, US_MapTest$City, US_MapTest$Latitude, US_MapTest$Longitude), 
                     FUN=mean)

#Need more comments here plz.

US_City_Simple <- CityTemp
US_City_Simple$dt<- US_City_Simple$Day<- US_City_Simple$Month <- NULL
AvgCity <- aggregate(US_City_Simple$AverageTemperature, 
                     by=list(US_City_Simple$Year, US_City_Simple$City, US_City_Simple$Latitude, US_City_Simple$Longitude), 
                     FUN=mean)

# Create Avg City by region tables.

US_West <- AvgCity[which(AvgCity$Group.2 =='Phoenix' | AvgCity$Group.2 =='Denver' | AvgCity$Group.2 =='Los Angeles'|
                           AvgCity$Group.2 =='Seattle' | AvgCity$Group.2 =='Las Vegas'),]
US_Midwest <- AvgCity[which(AvgCity$Group.2 =='Chicago' | AvgCity$Group.2 =='Omaha' | AvgCity$Group.2 =='Detroit'),]
US_Northeast <- AvgCity[which(AvgCity$Group.2 =='New York' | AvgCity$Group.2 =='Boston' | 
                                AvgCity$Group.2 =='Pittsburgh'),]
US_South <- AvgCity[which(AvgCity$Group.2 =='Miami' | AvgCity$Group.2 =='Washington' | AvgCity$Group.2 =='Houston'|
                            AvgCity$Group.2 =='Atlanta'),]

```


## Climate Change Model

```{r}
# Overall
AvgGlobal <- aggregate(GlobalTemp$LandAverageTemperature, 
                       by=list(GlobalTemp$Year), 
                       FUN=mean)

qplot(Group.1, x, data=AvgGlobal, main="Global Average Annual Temperature 1753-2013",
      geom=c("point","smooth"))+ aes(colour = x) + scale_color_gradient(low="blue", high="red")

model_lm <- lm(x ~ Group.1, data=AvgGlobal)
summary(model_lm)

# LM2

GlobalTemp_1850 <- GlobalTemp[which(GlobalTemp$Year >= 1850),]
AvgGlobal_1850 <- aggregate(GlobalTemp_1850$LandAverageTemperature, 
                       by=list(GlobalTemp_1850$Year), 
                       FUN=mean)
qplot(Group.1, x, data=AvgGlobal_1850, main="Global Average Annual Temperature 1850-2013",
      xlab="Year", ylab="Degrees (Celius)")+ stat_smooth(method = "lm", col = "blue")+ aes(colour = x) + scale_color_gradient(low="blue", high="red")
model_lm2 <- lm(x ~ Group.1, data=AvgGlobal_1850)
summary(model_lm2)

#LM3
GlobalTemp_1900 <- GlobalTemp[which(GlobalTemp$Year >= 1900),]
AvgGlobal_1900 <- aggregate(GlobalTemp_1900$LandAverageTemperature, 
                            by=list(GlobalTemp_1900$Year), 
                            FUN=mean)
qplot(Group.1, x, data=AvgGlobal_1900, main="Global Average Annual Temperature 1900-2013",
      xlab="Year", ylab="Degrees (Celius)")+ stat_smooth(method = "lm", col = "blue")+ aes(colour = x) + scale_color_gradient(low="blue", high="red")
model_lm3 <- lm(x ~ Group.1, data=AvgGlobal_1900)
summary(model_lm3)

#LM4
GlobalTemp_1975<- GlobalTemp[which(GlobalTemp$Year >= 1975),]
AvgGlobal_1975 <- aggregate(GlobalTemp_1975$LandAverageTemperature, 
                            by=list(GlobalTemp_1975$Year), 
                            FUN=mean)
qplot(Group.1, x, data=AvgGlobal_1975, main="Global Average Annual Temperature 1975-2013",
      xlab="Year", ylab="Degrees (Celius)")+ stat_smooth(method = "lm", col = "blue") + aes(colour = x) + scale_color_gradient(low="blue", high="red")
model_lm4 <- lm(x ~ Group.1, data=AvgGlobal_1975)
summary(model_lm4)

```


## Predictions

## Examples


## Interactive Plot

```{r eruptions}
inputPanel(
  selectInput("n_breaks", label = "Number of bins:",
              choices = c(10, 20, 35, 50), selected = 20),
  
  sliderInput("bw_adjust", label = "Bandwidth adjustment:",
              min = 0.2, max = 2, value = 1, step = 0.2)
)

renderPlot({
  hist(faithful$eruptions, probability = TRUE, breaks = as.numeric(input$n_breaks),
       xlab = "Duration (minutes)", main = "Geyser eruption duration")
  
  dens <- density(faithful$eruptions, adjust = input$bw_adjust)
  lines(dens, col = "blue")
})
```

